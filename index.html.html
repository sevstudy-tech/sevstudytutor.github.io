<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기초의학스터디 튜터 모집 현황</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; }
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-[#F1F5F9] text-slate-900 min-h-screen p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="bg-white rounded-[2rem] shadow-sm border border-slate-200 p-8 mb-10">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                <div>
                    <div class="inline-flex items-center gap-2 px-3 py-1 bg-indigo-50 text-indigo-600 rounded-full text-xs font-bold mb-3">
                        <span class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-indigo-600"></span>
                        </span>
                        LIVE STATUS
                    </div>
                    <h1 class="text-3xl font-black text-slate-900 tracking-tight">
                        기초의학스터디 <span class="text-indigo-600">튜터 선발</span> 현황
                    </h1>
                    <p class="text-slate-500 mt-2 font-medium">
                        구글 폼 응답 순서에 따라 과목별 확정 인원이 실시간으로 업데이트됩니다.
                    </p>
                </div>
                <div class="flex items-center gap-3 bg-slate-50 border border-slate-100 px-6 py-4 rounded-2xl">
                    <i data-lucide="refresh-ccw" id="refresh-icon" class="w-5 h-5 text-slate-400"></i>
                    <div class="text-right">
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Last Update</p>
                        <p id="last-updated-text" class="text-sm font-mono font-bold text-slate-700">--:--:--</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Grid Dashboard -->
        <div id="dashboard-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Cards will be injected here by JS -->
        </div>

        <!-- Footer Info -->
        <footer class="mt-16 bg-slate-900 rounded-[3rem] p-10 text-white shadow-2xl relative overflow-hidden">
            <div class="relative z-10 flex flex-col md:flex-row justify-between items-center gap-8">
                <div class="max-w-md">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-8 h-1 bg-indigo-500 rounded-full inline-block"></span>
                        운영 안내
                    </h3>
                    <ul class="text-sm text-slate-400 space-y-3 font-medium">
                        <li>• 구글 폼의 '타임스탬프' 0.1초 단위까지 계산하여 선착순을 적용합니다.</li>
                        <li>• 정원이 마감된 이후의 신청자는 '대기 명단'으로 분류됩니다.</li>
                        <li>• 모집 완료 후 확정 튜터에게는 개별 문자가 발송될 예정입니다.</li>
                    </ul>
                </div>
                <div class="text-center md:text-right">
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mb-2">Developed by</p>
                    <p class="text-lg font-black tracking-tight text-indigo-400">의과대학 학생회 교육정책국</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbytvcIhluQb802Z24he-7su7veorlh6TBk9ePsCUgWQltlHl_VSnWYh1-oGLqamcElc/exec";

        const SUBJECT_CONFIG = [
            { id: '세포대사와 분자생물', limit: 3, icon: 'microscope' },
            { id: '세포와 조직', limit: 2, icon: 'book-open' },
            { id: '약리학 총론', limit: 1, icon: 'zap' },
            { id: '면역과 병리 총론', limit: 1, icon: 'shield' },
            { id: '감염학 총론', limit: 1, icon: 'bug' },
            { id: '슬기로운 본과생활', limit: 1, icon: 'heart' },
        ];

        let submissions = [];

        async function fetchData() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.classList.add('loading-spin');

            try {
                const response = await fetch(API_URL);
                submissions = await response.json();
                
                document.getElementById('last-updated-text').textContent = new Date().toLocaleTimeString();
                renderDashboard();
            } catch (error) {
                console.error("데이터 로드 실패:", error);
            } finally {
                setTimeout(() => refreshIcon.classList.remove('loading-spin'), 500);
            }
        }

        function renderDashboard() {
            const grid = document.getElementById('dashboard-grid');
            grid.innerHTML = '';

            SUBJECT_CONFIG.forEach(subject => {
                const matched = submissions.filter(s => s.subject === subject.id);
                const confirmed = matched.slice(0, subject.limit);
                const isFull = confirmed.length >= subject.limit;

                const card = document.createElement('div');
                card.className = `group bg-white rounded-[2.5rem] border-2 transition-all duration-500 ${isFull ? 'border-slate-100 opacity-80' : 'border-white shadow-xl hover:scale-[1.02]'}`;
                
                let confirmedListHTML = confirmed.length > 0 
                    ? confirmed.map((person, idx) => `
                        <div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100 hover:bg-white hover:border-indigo-100 transition-all">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center text-[10px] font-black shadow-lg shadow-indigo-100">
                                    ${idx + 1}
                                </div>
                                <span class="font-bold text-slate-700 text-sm">${person.name}</span>
                            </div>
                            <span class="text-[10px] font-bold text-slate-400 bg-white px-2 py-1 rounded-lg border border-slate-100">${person.studentId || ''}</span>
                        </div>
                    `).join('')
                    : `
                        <div class="flex flex-col items-center justify-center py-10 opacity-10">
                            <i data-lucide="user-check" class="w-10 h-10"></i>
                            <p class="text-[10px] mt-2 font-black tracking-widest uppercase">Waiting</p>
                        </div>
                    `;

                card.innerHTML = `
                    <div class="p-6 rounded-t-[2.4rem] border-b flex items-center justify-between ${isFull ? 'bg-slate-50' : 'bg-slate-50/50'}">
                        <div class="flex items-center gap-3">
                            <div class="p-2.5 rounded-2xl bg-white shadow-sm text-slate-700">
                                <i data-lucide="${subject.icon}" class="w-5 h-5"></i>
                            </div>
                            <span class="font-extrabold text-sm">${subject.id}</span>
                        </div>
                        <div class="bg-white px-3 py-1.5 rounded-xl shadow-sm border border-slate-100">
                            <span class="text-xs font-black text-indigo-600">${confirmed.length}</span>
                            <span class="text-[10px] text-slate-300 mx-1">/</span>
                            <span class="text-xs font-bold text-slate-400">${subject.limit}</span>
                        </div>
                    </div>
                    <div class="p-8 min-h-[240px]">
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em]">Confirmed List</h4>
                            ${isFull ? '<i data-lucide="check-circle" class="w-4 h-4 text-emerald-500"></i>' : ''}
                        </div>
                        <div class="space-y-3">
                            ${confirmedListHTML}
                        </div>
                        ${isFull ? `
                            <div class="mt-8 pt-6 border-t border-dashed border-slate-200 text-center">
                                <p class="text-[11px] font-black text-rose-500 italic uppercase animate-pulse flex items-center justify-center gap-1">
                                    <i data-lucide="alert-circle" class="w-3 h-3"></i> Recruitment Finished
                                </p>
                            </div>
                        ` : ''}
                    </div>
                `;
                grid.appendChild(card);
            });
            
            // Re-initialize icons
            lucide.createIcons();
        }

        // Initial Load
        window.onload = () => {
            fetchData();
            // Refresh every 15 seconds
            setInterval(fetchData, 15000);
        };
    </script>
</body>
</html>